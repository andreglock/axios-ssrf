import { Inject, Injectable, Logger, UsePipes } from '@nestjs/common';
import axios from 'axios';
import { LoggingTool } from '../tools/logging/logging.tool';

@Injectable()
export class VulnerableService {
  constructor(@Inject(LoggingTool) private readonly loggingTool: LoggingTool) {
    this.loggingTool.setContext(VulnerableService.name);
  }

  private ROOT_URL = 'https://api.themoviedb.org/3/search/movie?api_key=8c20094b9d32bd14049b323d7d8294d0&language=en-US&&include_adult=false&query=';

  private internalAPIClient = axios.create({
    baseURL: this.ROOT_URL,
    headers: {
      'X-API-KEY': 'super secret API key to exploit with SSRF',
    },
  });

  async getMoviesBySearch(searchWord: string) {
    this.loggingTool.log(`Getting movies by search word: ${searchWord}`);

    return (
      await this.internalAPIClient.get(`${searchWord}`)
    ).data;
  }
}
